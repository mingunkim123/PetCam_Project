# 작업 보고서 #002: 환경 설정 분리

**작업일**: 2026-01-27  
**작업자**: 풀스택 개발자  
**작업 구분**: Week 1 (Day 3-4) - 프로덕션 환경 설정

---

## 📋 요약

이번 작업에서는 **"개발용"과 "실서비스용" 설정을 분리**하는 작업을 완료했습니다.

마치 **레스토랑의 주방(개발)과 매장(서비스)**을 분리하는 것처럼, 
개발자가 테스트할 때와 실제 고객이 사용할 때의 설정을 분리했습니다.

---

## 🤔 왜 이 작업이 필요한가요?

### 비유로 설명드리면...

집 열쇠를 생각해보세요.

- **개발 환경**: 연습용 열쇠 (잃어버려도 괜찮음)
- **프로덕션 환경**: 진짜 집 열쇠 (절대 잃어버리면 안 됨!)

지금까지는 이 두 열쇠가 섞여있었습니다.  
이번 작업으로 **연습용과 실제용을 완전히 분리**했습니다.

### 실제 문제점

| 이전 상태 | 문제점 |
|----------|--------|
| 비밀번호가 코드에 노출 | 해커가 쉽게 찾을 수 있음 |
| 개발/서비스 설정 혼재 | 실수로 테스트 데이터가 고객에게 노출될 수 있음 |
| 보안 정책이 느슨함 | 누구나 서버에 접속 가능 |

---

## ✅ 완료된 작업

### 1. 개발용 설정 파일 생성

**파일**: `ai_server/.env.development`

```
이 파일은 개발자가 테스트할 때 사용하는 설정입니다.

포함된 내용:
- 테스트용 비밀번호 (간단함)
- 모든 접속 허용 (테스트 편의)
- 상세한 로그 출력 (오류 찾기 쉬움)
```

**특징**:
- 간단한 비밀번호 (개발 편의성)
- 토큰 유효시간 24시간 (자주 로그인 안 해도 됨)
- 모든 도메인에서 접속 가능

---

### 2. 실서비스용 설정 예시 파일 생성

**파일**: `ai_server/.env.production.example`

```
이 파일은 "예시"입니다.
실제 서비스할 때는 이 파일을 복사해서
.env.production으로 만들고 실제 값을 입력합니다.
```

**특징**:
- 복잡한 비밀번호 필수
- 토큰 유효시간 30분 (보안 강화)
- 특정 도메인만 접속 허용
- 각 설정에 **한글 설명** 추가 (나중에 설정하기 쉬움)

---

### 3. 보안 정책(CORS) 개선

**파일**: `ai_server/main.py`

#### CORS가 뭔가요?

**비유**: 클럽의 출입 명단

- **이전**: 아무나 입장 가능 (위험!)
- **이후**: 명단에 있는 사람만 입장 가능 (안전!)

```
[이전 코드]
allow_origins=["*"]  ← 누구나 접속 가능 (위험!)

[변경 후]
allow_origins=환경변수에서 읽어옴
  - 개발: 누구나 접속 (테스트 편의)
  - 서비스: petcam.com만 접속 가능 (보안)
```

---

### 4. Git 보안 설정 강화

**파일**: `ai_server/.gitignore`

#### 이게 뭔가요?

Git은 코드를 저장하고 공유하는 도구입니다.  
`.gitignore`는 **"이 파일은 공유하지 마세요"** 라고 알려주는 목록입니다.

**추가된 규칙**:
```
.env                  ← 절대 공유 금지!
.env.production       ← 절대 공유 금지!
.env.development      ← 절대 공유 금지!
```

**비유**: 회사 서류 중 "대외비" 도장 찍기

---

## 📁 생성/수정된 파일 목록

| 파일 | 작업 | 설명 |
|------|------|------|
| `.env.development` | 🆕 신규 | 개발용 설정 |
| `.env.production.example` | 🆕 신규 | 서비스용 설정 예시 |
| `main.py` | ✏️ 수정 | 보안 정책 개선 |
| `.gitignore` | ✏️ 수정 | 비밀 파일 보호 |

---

## 🔄 변경 전후 비교

### main.py 변경 내용

| 항목 | 변경 전 | 변경 후 |
|------|---------|---------|
| CORS 설정 | `"*"` (하드코딩) | 환경변수에서 읽어옴 |
| 허용 도메인 | 모든 도메인 | 설정에 따라 제한 |
| 로깅 | 없음 | 어떤 도메인이 허용됐는지 로그 출력 |
| 코드 설명 | 없음 | 한글 주석 추가 |

---

## 📖 사용 방법 (나중에 참고)

### 개발할 때

```bash
# 개발 환경으로 서버 실행
docker-compose --env-file .env.development up -d
```

### 실제 서비스할 때

```bash
# 1. 예시 파일 복사
cp .env.production.example .env.production

# 2. .env.production 파일 열어서 실제 값 입력

# 3. 프로덕션 환경으로 서버 실행
docker-compose -f docker-compose.prod.yml --env-file .env.production up -d
```

---

## ⚠️ 중요 주의사항

### 절대 하면 안 되는 것

1. **`.env.production` 파일을 Git에 올리기**
   - 비밀번호가 전 세계에 공개됩니다!
   
2. **프로덕션에서 `ALLOWED_ORIGINS=*` 사용하기**
   - 해커가 쉽게 공격할 수 있습니다!

3. **개발용 비밀번호를 서비스에 사용하기**
   - 너무 간단해서 쉽게 뚫립니다!

### 반드시 해야 하는 것

1. ✅ 서비스 전에 `.env.production` 파일의 비밀번호 변경
2. ✅ `ALLOWED_ORIGINS`에 실제 도메인만 입력
3. ✅ `SECRET_KEY`를 32자 이상 무작위 문자열로 설정

---

## 🎯 이 작업으로 얻는 효과

| 효과 | 설명 |
|------|------|
| 🔒 **보안 강화** | 비밀번호와 설정이 코드에서 분리됨 |
| 🧪 **테스트 편의** | 개발할 때는 편하게, 서비스할 때는 안전하게 |
| 🚀 **배포 안전** | 실수로 테스트 설정이 서비스에 적용되는 것 방지 |
| 📝 **문서화** | 설정 파일에 한글 설명이 있어 나중에 이해하기 쉬움 |

---

## 📊 Week 1 프로덕션 환경 설정 진행률

| 작업 | 상태 |
|------|------|
| docker-compose.prod.yml | ✅ 완료 |
| nginx/nginx.conf | ✅ 완료 |
| .env.development | ✅ 완료 |
| .env.production.example | ✅ 완료 |
| main.py CORS 수정 | ✅ 완료 |
| .gitignore 보안 강화 | ✅ 완료 |

**Week 1 (Day 3-4) 프로덕션 환경 설정: 100% 완료** ✅

---

## 다음 단계

**Week 1 (Day 5-7): AWS 인프라 구축**
- Terraform으로 클라우드 인프라 자동 생성
- ECS, RDS, S3, ALB 설정

---

*보고서 작성일: 2026-01-27*  
*문의사항이 있으시면 언제든 말씀해주세요!*

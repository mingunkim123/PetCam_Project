version: '3.8'

services:
  app:
    build: .
    container_name: petcam_server
    ports:
      - "8000:8000"
    restart: always
    environment:
      - DATABASE_URL=${DATABASE_URL:?DATABASE_URL is required}
      - HOST=${HOST:-0.0.0.0}
      - PORT=${PORT:-8000}
      - SECRET_KEY=${SECRET_KEY:?SECRET_KEY is required}
      - ACCESS_TOKEN_EXPIRE_MINUTES=${ACCESS_TOKEN_EXPIRE_MINUTES:-30}
    depends_on:
      - db
    volumes:
      - ./storage:/app/storage
      - .:/app  # ğŸ’¡ ì½”ë“œ í•«ë¦¬ë¡œë“œìš© (ê°œë°œ í™˜ê²½)
    # ğŸ’¡ í•«ë¦¬ë¡œë“œ: ì½”ë“œ ìˆ˜ì • ì‹œ ìë™ ë°˜ì˜ (--reload)
    command: ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8000", "--reload"]

  db:
    image: postgres:15
    container_name: petcam_db

    restart: always
    environment:
      - POSTGRES_USER=${POSTGRES_USER:?POSTGRES_USER is required}
      - POSTGRES_PASSWORD=${POSTGRES_PASSWORD:?POSTGRES_PASSWORD is required}
      - POSTGRES_DB=${POSTGRES_DB:?POSTGRES_DB is required}
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"  # ì™¸ë¶€ 5433 â†’ ë‚´ë¶€ 5432 (ë¡œì»¬ PostgreSQLê³¼ ì¶©ëŒ ë°©ì§€)

volumes:
  postgres_data:
